API8:2023 自動化された脅威への不十分な保護 (Lack of Protection from Automated Threats)
======================================================================================

| 脅威エージェント/攻撃手法 | セキュリティ上の弱点 | 影響 |
| - | - | - |
| API 依存 : 悪用難易度 **3** | 普及度 **3** : 検出難易度 **1** | 技術的影響 **1** : ビジネス依存 |
| 悪用には通常、API のビジネスモデルの理解、機密性の高いビジネスフローの発見、これらのフローへのアクセスの自動化を必要とし、そのビジネスに損害を与えます。 | 分解すると、攻撃の各リクエストは完全に正当なリクエストであり、攻撃として識別できません。攻撃はサービスやアプリケーションのビジネスロジックに関するリクエストの合計に目を向けたときにのみ識別できます。 | 一般的に技術的影響は予期されません。悪用により次のようなさまざまな形でビジネスに悪影響を及ぼす可能性があります。1. 正規のユーザーが製品を購入できない 2. ゲームの内部経済にインフレをもたらす 3. 攻撃者が過剰な量のメッセージやコメントを送信して、フェイクニュースを拡散できる |

## その API は脆弱か？

自動化された脅威はより収益性が高く、より巧妙で、保護することがより困難になり、API はその格好のターゲットとして使用されることがよくあります。
レート制限や CAPTCHA などの従来の保護は時間の経過とともに効果が薄れていきます。
たとえば、(スキャルピング用の) ボットネットを操作する攻撃者は数秒のうちに世界中の何千もの場所や IP アドレスから簡単に API にアクセスできるためレート制限を回避できます。




脆弱な API には必ずしも実装上のバグがあるわけではありません。
チケット購入やコメント投稿などのビジネスフローを公開しているだけです。自動化された方法で過度に使用された場合に機能がどのような悪影響を及ぼすかを考慮していないだけで。



自動化された脅威には業界ごとに特有のリスクがあるかもしれません。


ビジネス上の重要な機能を公開しているのであれば API エンドポイントは脆弱であり、攻撃者は自動化された方法で過度にアクセスすることでビジネスに悪影響を及ぼすことができます。



[OWASP Automated Threats to Web Applications][1] ではさまざまな種類の自動化された脅威とその影響について説明しています。


## 攻撃シナリオの例

### シナリオ #1

あるテクノロジ企業が感謝祭に新しいゲーム機を発売すると発表しました。
この製品は非常に高い需要があり、在庫は限られています。
自動化された脅威のネットワークのオペレータである攻撃者は新しい製品を自動的に購入してトランザクションを完了するコードを記述します。


発売日に攻撃者はさまざまな IP アドレスやロケーションに分散したコードを実行します。
API は適切な保護を実装しておらず、攻撃者は他の正当なユーザーよりも先に在庫の大部分を購入できます。



その後、攻撃者は別のプラットフォームでその製品をはるかに高い価格で販売します。



### シナリオ #2

ライドシェアアプリは紹介プログラムを提供しています。ユーザーは友達を招待し、アプリに参加した友達ごとにクレジットを獲得できます。
このクレジットは後ほど乗車を予約する際に現金として使用できます。


攻撃者はこのフローを悪用し、スクリプトを記述して登録プロセスを自動化し、新規ユーザーごとに攻撃者のウォレットにクレジットを追加します。


攻撃者は後ほど無料乗車を楽しんだり、過剰なクレジットを持つアカウントを売却して現金に換えることができます。


## 防止方法

緩和計画は二つの層で行います。

* ビジネス - 過度に使用された場合にビジネスに悪影響を及ぼす可能性のあるビジネスフローを特定します。

* エンジニアリング - 適切な保護メカニズムを選択して、ビジネスリスクを軽減します。


  保護メカニズムの中にはよりシンプルなものもあれば、実装がより困難なものもあります。自動化された脅威を遅らせるには以下の方法を使用します。



  * デバイスフィンガープリント: 予期せぬクライアントデバイス (ヘッドレスブラウザなど) へのサービスを拒否すると、脅威アクターはより洗練されたソリューションを使用する傾向があり、脅威アクターにとってよりコストがかかるようになります。


  * 人間検出: CAPTCHA やより高度な生体認証ソリューション (タイピングパターンなど) のいずれかを使用します。

  * 非人間パターン: ユーザーフローを解析して非人間パターン (「カートに追加」や「購入を完了」機能を一秒以内でアクセスしたユーザーなど) を検出します。


  * Tor 出口ノードやよく知られたプロキシの IP アドレスをブロックすることを検討します。
* マシンによって直接使用される API (開発者 API や B2B API など) へのアクセスを保護して制限します。これらは必要な保護メカニズムのすべてを実装してはいないことが多いため、攻撃者の格好のターゲットになる傾向があります。



## 参考資料

### OWASP

* [OWASP Automated Threats to Web Applications][1]
* [API10:2019 Insufficient Logging & Monitoring][2]

[1]: https://owasp.org/www-project-automated-threats-to-web-applications/
[2]: https://github.com/OWASP/API-Security/blob/master/2019/en/src/0xaa-insufficient-logging-monitoring.md
